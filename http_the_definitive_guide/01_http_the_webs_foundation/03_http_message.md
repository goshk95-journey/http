# 03.HTTP 메시지

## 3.1 메시지의 흐름

HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 `데이터의 블록`들이다.

### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다

HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다. 메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.

### 3.1.2 다운스트림으로 흐르는 메시지

HTTP 메시지는 요청, 응답 관계없이 모든 메시지는 다운스트림으로 흐른다.

## 3.2 메시지의 각 부분

HTTP 메시지는 단순한, 데이터의 구조화된 블록이다. 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어진다.

시작줄과 헤더는 그냥 줄 단위로 분리된 아스키 문자열이다. 각 줄은 캐리지 리턴과 개행문자로 구성된 두 글자의 줄바꿈 문자열로 끝난다. 이 줄바꿈 문자열은 `CRLF`라고 쓴다. 오래되거나 잘못 만들어진 HTTP 애플리케이션들 중에서는 캐리지 리턴과 개행 문자 모두를 항상 전송하지는 않는 것들도 있다.

엔티티 본문이나 메시지 본문은 시작줄이나 헤더와 달리 텍스트나 이진 데이터를 포함할 수도 있고 그냥 비어있을 수도 있다.

### 3.2.1 메시지 문법

모든 HTTP 메시지는 요청 또는 응답 메시지로 분류된다.

#### 요청 메시지의 형식

```text
<HTTP 메서드> | <요청 URL> | <HTTP 버전>

<헤더>

<엔티티 본문>
```

#### 응답 메시지의 형식

```text
<HTTP 버전> | <상태 코드> | <사유 구절>

<헤더>

<엔티티 본문>
```

### 3.2.2 시작줄

모든 HTTP 메시지는 시작줄로 시작한다.

#### 요청줄

요청 메시지의 시작줄, 혹은 요청줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있다. 또한 요청줄은 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함한다.

#### 응답줄

응답 메시지의 시작줄 혹은 응답줄에는 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절이 들어있다.

### 3.2.3 헤더

HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다.

### 3.2.4 엔티티 본문

엔티티 본문은 HTTP 메시지의 화물이라고 할 수 있다. 이러한 엔티티 본문을 이용하여 HTTP 메시지는 이미지, 비디오, 텍스트 문서 등 여러 종류의 데이터를 실어 나를 수 있다.

### 3.2.5 버전 0.9 메시지

HTTP 버전 0.9는 `HTTP 프로토콜의 초기 버전`이다. 오늘날 HTTP 버전의 시초이지만, 훨씬 단순한 프로토콜로 되어있다.

HTTP/0.9 메시지도 마찬가지로 요청과 응답으로 이루어져 있지만, 요청은 그저 메서드와 요청 URL을 갖고 있을 뿐이며, 응답은 오직 엔티티로만 되어 있다. 버전 정보, 상태 코드나 사유 구절도 없으며, 헤더도 포함되어 있지 않다.

## 3.3 메서드

### 3.3.1 안전한 메서드(Safe Method)

HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의한다. GET과 HEAD 메서드는 안전하다고 할 수 있는데, 이는 GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.

작용이 없다는 것은, HTTP 요청의 결과로 인해 서버에서 일어나는 일은 아무것도 없다는 의미이다.

### 3.3.2 GET

GET 메소드는 주로 서버에게 리소스를 달라고 요청하기 위해 사용된다.

### 3.3.3 HEAD

HEAD 메서드는 저오학히 GET처럼 행동하지만, 서버는 응답으로 헤더만을 돌려준다. 엔티티 본문은 절대로 반환되지 않는다.

> 서버 개발자들은 반드시 반환되는 헤더가 GET으로 얻는 것과 정확히 일치함을 보장해야 한다.

### 3.3.4 PUT

PUT 메서드는 새로운 리소스를 만들거나, 이미 리소스가 존재한다면 해당 리소스를 교체한다.

### 3.3.5 POST

POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계되었다. 실제로 HTML 폼을 지원하기 위해 흔히 사용된다.

### 3.3.6 TRACE

TRACE 메서드는 주로 '루프백' 진단을 위해 사용된다. 예를 들면 요청이 의도한 요청/응답 연쇄를 거쳐가는지 검사할 수 있다.

### 3.3.7 OPTIONS

OPTIONS 메서드는 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어본다. 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다.

### 3.3.8 DELETE

DELETE 메서드는 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.

### 3.3.9 확장 메서드

확장 메서드는 HTTP/1.1 명세에 정의되지 않은 메서드다. 그들은 개발자들에게 그들의 서버가 구현한 HTTP 서비스의 서버가 관리하는 리소스에 대한 능력을 확장하는 수단을 제공한다.

## 3.4 상태 코드

### 3.4.1 100-199: 정보성 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| ------ | ------- | ------------ |
| 100 | Continue | 요청의 시작 일부가 받아들여졌으며, 클라이언트는 나머지를 계속 이어서 보내야 함을 의미한다. 이것을 보낸 후, 서버는 반드시 요청을 받아 응답해야 한다. |
| 101 | Switching Protocols | 클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음을 의미한다. |

### 3.4.2 200-299: 성공 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| ------ | ------- | ------------ |
| 200 | OK | 요청은 정상이고 엔티티 본문은 리소스를 포함하고 있다. |
| 201 | Created | 서버 개체를 생성하라는 요청을 위한 것. 리소스에 대한 구체적인 참조가 담긴 Location 헤더와 함께 응답한다. </br> 서버는 상태 코드를 보내기에 앞서 반드시 객체를 생성해야 한다.|
| 202 | Accepted | 요청은 받아들여졌으나 서버는 아직 그에 대한 어떤 동작도 수행하지 않았다. 서버가 요청의 처리를 완료할 것인지에 대한 어떤 보장도 없다. |
| 204 | No Content | 응답 메시지는 헤더와 상태줄을 포함하지만 엔티티 본문은 포함하지 않는다. |
| 206 | Partial Content | 부분 혹은 범위 요청이 성공했다. </br> 206 응답은 Content-Range와 Date 헤더를 반드시 포함해야 하며, Etag와 Content-Location 중 하나의 헤더도 반드시 포함해야 한다. |

### 3.4.3 300-399: 리다이렉션 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| ------ | ------- | ------------ |
| 300 | Multiple Choices | 클라이언트가 동시에 여러 리소스를 가리키는 URL을 요청한 경우, 그 리소스의 목록과 함께 반환한다. |
| 301 | Moved Permanently | 요청한 URL이 옮겨졌을 때 사용한다. 응답은 Location 헤더에 현재 리소스가 존재하고 있는 URL을 포함해야 한다.(영구적 리다이렉트) |
| 302 | Found | 301 상태 코드와 같다. 그러나 클라이언트는 Location 헤더로 주어진 URL을 리소스를 임시로 가리키기 위한 목적으로 사용해야 한다.(임시적 리다이렉트) |
| 307 | Temporary Redirect | 요청한 리소스가 Location 헤더에 주어진 URL로 임시로 옮겨졌다는 것을 나타낸다.(임시적 리다이렉트) |
| 308 | Permanent Redirect | 요청된 리소스가 Location 헤더에 지정된 URL로 확실히 이동되었음을 나타낸다.(영구적 리다이렉트) |

### 3.4.4 400-499: 리다이렉션 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| ------ | ------- | ------------ |
| 400 | Bad Request | 클라이언트가 잘못된 요청을 보냈다고 말해준다. |
| 401 | Unauthorized | 리소스를 얻기 위해 인증이 필요함을 말해준다. |
| 403 | Forbidden | 요청이 서버에 의해 거부되었음을 알려주기 위해 사용한다. |
| 404 | Not Found | 서버가 요청한 URL을 찾을 수 없음을 알려주기 위해 사용한다. |
| 405 | Method Not Allowed | 요청한 URL에 대해, 지원하지 않는 메서드로 요청받았을 때 사용한다. |

### 3.4.5 300-599: 서버 에러 상태 코드

| 상태 코드 | 사유 구절 | 의미 |
| ------ | ------- | ------------ |
| 500 | Internal Server Error | 서버가 요청을 처리할 수 없게 만드는 에러를 만났을 때 사용한다. |
| 502 | Bad Gateway | 프록시나 게이트웨이처럼 행동하는 서버가 그 요청 응답 연쇄에 있는 다음 링크로부터 가짜 응답에 맞닥뜨렸을 때 사용한다. |

## 3.5 헤더

### 일반 헤더

일반 헤더는 클라이언트와 서버 양쪽 모두가 사용한다. 예를 들어, Date 헤더는 서버와 클라이언트를 가리지 않고 메시지가 만들어진 일시를 지칭하기 위해 사용하는 일반 목적 헤더이다.

### 요청 헤더

요청 메시지를 위한 헤더이다. 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공한다.

### 응답 헤더

응답 메시지를 위한 헤더이다. 응답 헤더는 클라이언트에게 부가 정보를 제공한다.

### 엔티티 헤더

엔티티 본문에 대한 헤더를 말한다. 예를 들어, 엔티티 헤더는 엔티티 본문에 들어있는 데이터의 타입이 무엇인지 말해줄 수 있다.

### 확장 헤더

확장헤더는 애플리케이션 개발자들에 의해 만들어졌지만 HTTP 명세에는 추가되지 않은 비표준 헤더다.
